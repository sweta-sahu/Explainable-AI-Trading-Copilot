# Use the official AWS Lambda Python 3.10 base image
FROM public.ecr.aws/lambda/python:3.10

# Copy requirements file
COPY requirements.txt ${LAMBDA_TASK_ROOT}/

# Install Python dependencies for the correct platform.
# The --platform flag for pip is crucial for cross-compiling on a Mac for Lambda (x86_64).
# It forces pip to download pre-compiled "wheels" compatible with the Lambda runtime.
RUN pip install --upgrade pip && \
    pip install \
    --platform manylinux2014_x86_64 \
    --target=${LAMBDA_TASK_ROOT} \
    --implementation cp \
    --python-version 3.10 \
    --only-binary=:all: \
    --no-cache-dir \
    -r ${LAMBDA_TASK_ROOT}/requirements.txt

# Copy the Lambda function code (no changes needed)
COPY handler.py ${LAMBDA_TASK_ROOT}/

# Set the CMD to your handler (no changes needed)
CMD [ "handler.lambda_handler" ]